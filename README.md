# Database 2 Project 21/22 Polimi
## Contributors
[Giovanni De Novellis](https://github.com/GiovanniDeNovellis)<br>
[Carlo Lazzari](https://github.com/unbearableDarkness)
## Project
The goal of the project was to create a a telco website with two different applications for the two main type of users: Customers and Employees. Customers are able to purchase and make subscriptions to specific service packages which are created by Employees that, in addition to creating packages, are also able to inspect data about the sales, computed through triggers and materialized views. <br>
For the database we used MYSQL with triggers to compute the materialized views for the sales data, TomEE for the application server, JPA with EJB for the transaction management and the business objects and Java Servlets with Thymeleaf for the frontend. 
## Complete specification
### TELCO SERVICE APPLICATIONS
A telco company offers pre-paid online services to web users. Two client applications using the same database need to be developed.
#### CONSUMER APPLICATION
The consumer application has a public Landing page with a form for login and a form for registration. Registration requires a username (which can be assumed as the unique identification parameter), a password and an email. Login leads to the Home page of the consumer application. Registration leads back to the landing page where the user can log in.<br>
The user can log in before browsing the application or browse it without logging in. If the user has logged in, his/her username appears in the top right corner of all the application pages.<br>
The Home page of the consumer application displays the service packages offered by the telco company.<br>
A service package has an ID and a name (e.g., “Basic”, “Family”, “Business”, “All Inclusive”, etc). It comprises one or more services. Services are of four types: fixed phone, mobile phone, fixed internet, and mobile internet. The mobile phone service specifies the number of minutes and SMSs included in the package plus the fee for extra minutes and the fee for extra SMSs. The fixed phone service has no specific configuration parameters. The mobile and fixed internet services specify the number of Gigabytes included in the package and the fee for extra Gigabytes. A service package must be associated with one validity period. A validity period specifies the number of months (12, 24, or 36). Each validity period has a different monthly fee (e.g., 20€/month for 12 months, 18€/month for 24 months, and 15€ /month for 36 months). A package may be associated with one or more optional products (e.g., an SMS news feed, an internet TV channel, etc.). The validity period of an optional product is the same as the validity period that the user has chosen for the service package. An optional product has a name and a monthly fee independent of the validity period duration. The same optional product can be offered in different service packages.<br>
From the Home page, the user can access a Buy Service page for purchasing a service package and thus creating a service subscription. The Buy Service page contains a form for purchasing a service package. The form allows the user to select one package from the list of available ones and choose the validity period duration and the optional products to buy together with the chosen service. The form also allows the user to select the start date of his/her subscription. After choosing the service packages, the validity period and (0 or more) optional products, the user can press a CONFIRM button. The application displays a CONFIRMATION page that summarizes the details of the chosen service package, the validity period, the optional products and the total price to be pre-paid: (monthly fee of service package * number of months) + (sum of monthly fees of options * number of months).<br>
If the user has already logged in, the CONFIRMATION page displays a BUY button. If the user has not logged in, the CONFIRMATION page displays a link to the login page and a link to the REGISTRATION page. After either logging in or registering and immediately logging in, the CONFIRMATION page is redisplayed with all the confirmed details and the BUY button.<br>
When the user presses the BUY button, an order is created. The order has an ID and a date and hour of creation. It is associated with the user and with the service package, its validity period and the chosen optional products. It also contains the total value (as in the CONFIRMATION page) and the start date of the subscription. After creating the order, the application bills the customer by calling an external service. If the external service accepts the billing, the order is marked as valid and a service activation schedule is created for the user. A service activation schedule is a record of the services and optional products to activate for the user with their date of activation and date of deactivation.<br>
If the external service rejects the billing, the order is put in the rejected status and the user is flagged as insolvent. When an insolvent user logs in, the home page also contains the list of rejected orders. The user can select one of such orders, access the CONFIRMATION page, press the BUY button and attempt the payment again. When the same user causes three failed payments, an alert is created in a dedicated auditing table, with the user Id, username, email, and the amount, date and time of the last rejection.
#### EMPLOYEE APPLICATION
The employee application allows the authorized employees of the telco company to log in. In the Home page, a form allows the creation of service packages, with all the needed data and the possible optional products associated with them. The same page lets the employee create optional products as well.<br>
A Sales Report page allows the employee to inspect the essential data about the sales and about the users over the entire lifespan of the application:
 - Number of total purchases per package.
 - Number of total purchases per package and validity period.
 - Total value of sales per package with and without the optional products.
 - Average number of optional products sold together with each service package.
 - List of insolvent users, suspended orders and alerts.
 - Best seller optional product, i.e. the optional product with the greatest value of sales across all the sold service packages.
